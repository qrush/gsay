#!/usr/bin/env ruby

require 'tempfile'
require 'open-uri'

words = ARGV.first.scan(/\w+/).map(&:downcase)

begin
  sounds = words.map { |word| Tempfile.new(word) }

  words.each_with_index do |word, index|
    @word = word
    url = "https://ssl.gstatic.com/dictionary/static/sounds/de/0/#{word}.mp3"
    sounds[index].write(open(url).read)
  end

  `mpg123 -q #{sounds.map(&:path).join(" ")}`
rescue OpenURI::HTTPError
  abort "Couldn't gsay '#{@word}' :("
ensure
  sounds.each do |sound|
    sound.close
    sound.unlink
  end
end
